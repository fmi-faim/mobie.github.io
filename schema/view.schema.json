{
    "$schema": "http://json-schema.org/draft-07/schema",
    "$id": "https://raw.githubusercontent.com/mobie/mobie.github.io/master/schema/view.schema.json",
    "title": "MoBIEViewSchema",
    "description": "Schema for serializing the MoBIE viewer state",
    "definitions": {

        "imageDisplays": {
            "description": "",
            "type": "object",
            "properties": {
                "imageDisplays": {
                    "description": "Viewer state for a group of image sources.",
                    "type": "object",
                    "properties": {
                        "color": {
                            "description": "The color map.",
                            "type": "string",
                            "enum": ["red", "green", "blue", "white"]
                        },
                        "contrastLimits": {
                            "description": "The contrast limits.",
                            "type": "array",
                            "items": [
                                {
                                    "type": "number",
                                    "minimum": 0,
                                    "maximum": 32767
                                },
                                {
                                    "type": "number",
                                    "minimum": 0,
                                    "maximum": 32767
                                }
                            ],
                            "additionalItems": false
                        },
                        "name": {
                            "description": "The name of this display group.",
                            "type": "string"
                        },
                        "resolution3dView": {
                            "description": "The resolution used for the 3d viewer, in physical units. Only relevant if 'showImageIn3d' is true. Will be determined automatically if not specified.",
                            "type": "array",
                            "items": {
                                "type": "number",
                                "exclusiveMinimum": 0
                            },
                            "minItems": 3,
                            "maxItems": 3
                        },
                        "showImagesIn3d": {
                            "description": "Whether to show the images in the 3d viewer.",
                            "type": "boolean"
                        },
                        "sources": {
                            "description": "The image sources that are part of this display group.",
                            "type": "array",
                            "items": {
                                "type": "string"
                            },
                            "minItems": 1
                        }
                    },
                    "required": ["color", "contrastLimits", "name", "sources"],
                    "additionalProperties": false
                }
            },
            "required": ["imageDisplays"],
            "additionalProperties": false
        },

        "segmentationDisplays": {
            "description": "Viewer state for a group of segmentation sources.",
            "type": "object",
            "properties": {
                "segmentationDisplays": {
                    "description": "",
                    "type": "object",
                    "properties": {
                        "alpha": {
                            "description": "The alpha value used for blending segmentation and image data in the viewer.",
                            "type": "number",
                            "minimum": 0,
                            "maximum": 1
                        },
                        "color": {
                            "description": "The segmentation color map.",
                            "type": "string",
                            "enum": ["argbColumn", "blueWhiteRed", "glasbey", "viridis"]
                        },
                        "colorByColumn": {
                            "description": "Name of table column that is used for coloring. By default the 'label_id' column is used.",
                            "type": "string"
                        },
                        "name": {
                            "description": "The name of this display group.",
                            "type": "string"
                        },
                        "resolution3dView": {
                            "description": "Resolution used for the 3d viewer, in physical units. Only relevant if 'showSelectedSegmentsIn3d' is true. Will be determined automatically if not specified.",
                            "type": "array",
                            "items": {
                                "type": "number",
                                "exclusiveMinimum": 0
                            },
                            "minItems": 3,
                            "maxItems": 3
                        },
                        "selectedSegmentIds": {
                            "description": "List of selected segment ids.",
                            "type": "array",
                            "items": {
                                "type": "string",
                                "pattern": "^-"
                            }
                        },
                        "showSelectedSegmentsIn3d": {
                            "description": "Whether to show the selected segments in the 3d viewer.",
                            "type": "boolean"
                        },
                        "sources": {
                            "description": "The segmentation sources that are part of this display group.",
                            "type": "array",
                            "items": {
                                "type": "string"
                            },
                            "minItems": 1
                        },
                        "tables": {
                            "description": "Additional tables to load. If present, the default table will always be loaded and should not be specified here.",
                            "type": "array",
                            "items": {
                                "type": "string"
                            },
                            "minItems": 1
                        },
                        "valueLimits": {
                            "description": "Value limits for numerical color maps like 'blueWhiteRed'.",
                            "type": "array",
                            "items": [
                                {
                                    "type": "number"
                                },
                                {
                                    "type": "number"
                                }
                            ],
                            "additionalItems": false
                        }
                    },
                    "required": ["alpha", "color", "name", "sources"],
                    "additionalProperties": false
                }
            },
            "required": ["segmentationDisplays"],
            "additionalProperties": false
        },

        "affine": {
            "description": "",
            "type": "object",
            "properties": {
                "affine": {
                    "description": "Affine transformation applied to a list of sources.",
                    "type": "object",
                    "properties": {
                        "name": {
                            "description": "Name of this transformation.",
                            "type": "string"
                        },
                        "parameters": {
                            "description": "Parameters of the affine transformation, using the BigDataViewer convention.",
                            "type": "array",
                            "items": {
                                "type": "number"
                            },
                            "minItems": 12,
                            "maxItems": 12
                        },
                        "sources": {
                            "description": "The sources this transformation is applied to.",
                            "type": "array",
                            "items": {
                                "type": "string"
                            },
                            "minItems": 1
                        },
                        "timepoints": {
                            "description": "The valid timepoints for this transformation. If none is given, the transformation is valid for all timepoints.",
                            "type": "array",
                            "items": {
                                "type": "integer",
                                "minimum": 0
                            },
                            "minItems": 1
                        }
                    },
                    "required": ["name", "parameters", "sources"],
                    "additionalProperties": false
                }
            },
            "required": ["affine"],
            "additionalProperties": false
        },

        "autoGrid": {
            "description": "",
            "type": "object",
            "properties": {
                "autoGrid": {
                    "description": "Arange a list of soures in grid.",
                    "type": "object",
                    "properties": {
                        "name": {
                            "description": "Name of the grid.",
                            "type": "string"
                        },
                        "sources": {
                            "description": "The sources for the grid. The outer list specifies the grid posititions, the inner list the sources per grid position.",
                            "type": "array",
                            "items": {
                                "type": "array",
                                "items": {
                                    "type": "string",
                                    "minItems": 1
                                }
                            },
                            "minItems": 2
                        },
                        "tableDataRootLocation": {
                            "description": "Location of the table root directory for this grid view, relative to the dataset root directory.",
                            "type": "string"
                        },
                        "timepoints": {
                            "description": "The valid timepoints for this transformation. If none is given, the transformation is valid for all timepoints.",
                            "type": "array",
                            "items": {
                                "type": "integer"
                            },
                            "minItems": 1
                        }
                    },
                    "required": ["name", "sources", "tableDataRootLocation"],
                    "additionalProperties": false
                }
            },
            "required": ["autoGrid"],
            "additionalProperties": false
        }
    },

    "type": "object",
    "properties": {
        "sourceDisplays": {
            "description": "The display groups of this view.",
            "type": "array",
            "items": {"anyOf": [
                {"$ref": "#/definitions/imageDisplays"},
                {"$ref": "#/definitions/segmentationDisplays"}
            ]}
        },
        "sourceTransforms": {
            "description": "The source transformations of this view.",
            "type": "array",
            "items": {"anyOf": [
                {"$ref": "#/definitions/affine"},
                {"$ref": "#/definitions/autoGrid"}
            ]}
        },
        "viewerTransform": {
            "description": "The viewer transformation of this view.",
            "type": "object",
            "oneOf": [
                {
                    "properties": {
                        "timepoint": {
                            "description": "The initial timepoint shown in the viewer.",
                            "type": "integer",
                            "minimum": 0
                        }
                    },
                    "required": ["timepoint"],
                    "additionalProperties": false
                },
                {
                    "properties": {
                        "affine": {
                            "description": "Affine transformation applied by the viewer.",
                            "type": "array",
                            "items": {
                                "type": "number"
                            },
                            "minItems": 12,
                            "maxItems": 12
                        },
                        "timepoint": {
                            "description": "The initial timepoint shown in the viewer.",
                            "type": "integer",
                            "minimum": 0
                        }
                },
                "required": ["affine"],
                "additionalProperties": false
                },
                {
                    "properties": {
                        "normalizedAffine": {
                            "description": "Normalized affine transformation applied by the viewer.",
                            "type": "array",
                            "items": {
                                "type": "number"
                            },
                            "minItems": 12,
                            "maxItems": 12
                        },
                        "timepoint": {
                            "description": "The initial timepoint shown in the viewer.",
                            "type": "integer",
                            "minimum": 0
                        }
                    },
                    "required": ["normalizedAffine"],
                    "additionalProperties": false
                },
                {
                    "properties": {
                        "position": {
                            "description": "Position that will be centered in the viewer.",
                            "type": "array",
                            "items": {
                                "type": "number",
                                "minimum": 0
                            },
                            "minItems": 3,
                            "maxItems": 3
                        },
                        "timepoint": {
                            "description": "The initial timepoint shown in the viewer.",
                            "type": "integer",
                            "minimum": 0
                        }
                    },
                    "required": ["position"],
                    "additionalProperties": false
                }
            ]
        }
    },
    "required": ["sourceDisplays"],
    "additionalProperties": false
}
